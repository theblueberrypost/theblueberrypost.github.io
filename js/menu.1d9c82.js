var registerMenuClass,initMenu;function MenuItem(){this.parent=void 0,this.element=void 0,this.data=void 0}function Menu(){this.items=new Array}!function(){var t=$,e={},n=void 0,i=!1,r=!1,a=!1,u=function(e){if(menuData=s(e),null==menuData)return!1;var n=menuData.items,i=function(t){var e=null!=t&&null!=t.menuClass?t.menuClass:"Menu";return new window[e]}(menuData),r=t(e).parent(),a=t(r)[0].itemData;null!=a&&(a.subMenu=i),i.setData(menuData,e);var o=!0;return t(e).children("li").each(function(){var e=function(t){var e=null!=t&&null!=t.menuItemClass?t.menuItemClass:"MenuItem";return new window[e]}(n);e.setData(n,this),i.items.push(e),t(this).children("ul").each(function(){u(this)||(o=!1)}),e.addEvents()}),i.addEvents(),o},o=function(e){t(e).each(function(){var e=t(this)[0].itemData;null!=e&&(null!=e.subMenu&&t(this).children("ul").each(function(){o(t(this).children())}),"none"!=t(this).children().first().css("display")&&e.animate("hover_out"),e.restore(),e.open=!1,e.autoHoverOut=void 0)})},s=function(e){var n=void 0,i=t(e).attr("class").split(/\s+/);return t.each(i,function(t,e){if(null!=(n=l(e)))return!1}),n},l=function(t){return e[t]},h=function(){var e=t(".menu-device").css("background-color");return null!=e?parseInt(e.substring(4)):0},p=function(e){t(e).each(function(){"none"==t(this).css("display")&&t(this).css("display","block")}),null==p.id&&(p.id=0),++p.id,t(document).on("touchend.menu."+p.id,function(e,n){return function(i){for(var r=t(e)[0].itemData,a=e;null!=r.parent;)a=r.element,r=r.parent;a.contains(i.target)||(n<=p.id&&(o(a),p.id=n-1),t(document).off("touchend.menu."+n))}}(e,p.id))};registerMenuClass=function(t,n){e[t]=n},initMenu=function(t){return!!u(t)},MenuItem.prototype.setData=function(e,n){this.data=e,this.element=n,parentElement=t(n).parent();var i=t(parentElement)[0].itemData;this.parent=null!=i?i:void 0,t(n)[0].itemData=this};var d=function(e,n){for(var i in n)if(0==i.indexOf("child:")){for(var r=i.substr(6).split(":"),a=e,u=0;u<r.length;u++)a=t(a).children().eq(r[u]);null!=n[i].tag&&(a=t(a).find(n[i].tag)),d(a,n[i].properties)}else"animate"!=i&&"duration"!=i&&("style"==i?n[i].length?t(e).attr(i,n[i]):t(e).removeAttr(i):t(e).css(i,n[i]))},f=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},m=function(t){var e={};for(var n in t)f(t[n])?e[n]=m(t[n]):e[n]=t[n];return e},c=function(t,e){var n=m(t);for(var i in e)f(n[i])&&f(e[i])?n[i]=c(t[i],e[i]):n[i]=e[i];return n};MenuItem.prototype.addEvents=function(){var e=function(e){if("touchstart"==e.type){if(a=!1,0==r&&(r=!0,1==i))return}else if("touchend"==e.type&&(a=!0),1==r&&("touchend"==e.type||0==a&&"click"==e.type))return;for(var n,u=e.target,s=t(u)[0].itemData;null==s&&null!=u;)u=u.parentElement,s=t(u)[0].itemData;if(null!=s.subMenu)"none"==t(s.subMenu.element).css("display")?(s.hoverIn.call(s.element,e),s.expand()):t(s.subMenu.element).is(":animated")||setTimeout((n=s.element,function(){o(n)}),50);else{for(var l;null!=s.parent;)l=s.element,s=s.parent;setTimeout(function(t){return function(){o(t)}}(l),500)}},n=this.element,u=this.subMenu;null!=this.data.hover?(t(n).hover(this.hover),null==u&&t(n).on("touchstart",this.hover)):null!=this.data.hover_in&&null!=this.data.hover_out&&(t(n).hover(this.hoverIn,this.hoverOut),t(n).on("touchstart",null!=u?e:this.hoverIn),null==u&&t(n).on("touchend",e)),t(n).on("click",e)},MenuItem.prototype.getAnimationProperties=function(e,n){if(null!=e){null==this.values&&(this.values={});var i=h();if(null==this.values[i]){var r=this.element;this.values[i]={width:t(r).width(),height:t(r).height(),marginLeft:t(r).css("margin-left"),marginTop:t(r).css("margin-top")}}for(var a=i;null!=e&&a>=0&&null==e[a];)--a;a>=0&&null!=e&&(e=e[a]);var u=t.extend({},e);return"initial"==u.width?u.width=this.values[i].width:"+dx"==u.width?u.width=parseInt(this.values[i].width)+parseInt(n.dx)+"px":"dx"==u.width&&(u.width=parseInt(n.dx)+"px"),"initial"==u.height?u.height=this.values[i].height:"+dy"==u.height?u.height=parseInt(this.values[i].height)+parseInt(n.dy)+"px":"dy"==u.height&&(u.height=parseInt(n.dy)+"px"),"dx"==u.left&&(u.left=n.dx+"px"),"dy"==u.top&&(u.top=n.dy+"px"),"dy"==u.marginTop?u.marginTop=parseInt(n.dy)+"px":"-dy"==u.marginTop&&(u.marginTop=-parseInt(n.dy)+"px"),"-dy"==u.paddingTop&&(u.paddingTop=-parseInt(n.dy)+"px"),u}},MenuItem.prototype.animate=function(e,n){var i=this.element,r=null!=n&&null!=n.queue?n.queue:"fx",a=e.indexOf(":"),u=void 0;a>0&&(u=e.substring(a+1),e=e.substring(0,a));var o=this.data[e];null!=u&&(o=c(o,this.data[e+"_"+u])),null!=o.autoHoverOut&&(this.autoHoverOut=o.autoHoverOut),null!=o.before&&d(i,this.getAnimationProperties(o.before,n));var s,l=h();if(t(i).stop(r,!0).animate(this.getAnimationProperties(o.properties,n),{duration:1==o.animate?o.duration:0,queue:r,complete:(s=this.getAnimationProperties(o.after,n),function(){null==s&&(s={}),s.overflow="",d(this,s)}),step:function(e,n,i){return function(){null==e&&(e={}),null==e.overflow&&(e.overflow="visible");var r=e.calc;if(null!=r){Array.isArray(r)||(r=[r]);for(var a=t(this).width(),u=0;u<r.length;u++)"marginTop"==r[u]?e.marginTop=parseInt(n.values[i].marginTop)+(parseInt(n.values[i].height)-t(this).height())+"px":"marginLeft"==r[u]?e.marginLeft=parseInt(n.values[i].marginLeft)+(parseInt(n.values[i].width)-a)+"px":"width"==r[u]&&(a=0,t(this).children("li").each(function(){a+=t(this).width(),a+=parseInt(t(this).css("margin-left")),a+=parseInt(t(this).css("border-left")),a+=parseInt(t(this).css("margin-right")),a+=parseInt(t(this).css("border-right"))}),e.width=a+1+"px")}d(this,e)}}(this.getAnimationProperties(o.step,n),this,l)}).dequeue(r),null!=o.content&&this.animateContent(o.content.event,n),null!=o.submenu){var p=o.submenu.event;null!=this.subMenu&&("function"==typeof this.subMenu[p]?this.subMenu[p].call(this.subMenu.element):this.subMenu.animate(p,n))}if(null!=o.parentmenu){var f=o.parentmenu.event;null!=this.parent&&("function"==typeof this.parent[f]?this.parent[f].call(this.parent.element):this.parent.animate(f,n))}},MenuItem.prototype.animateContent=function(t,e){this.doAnimateContent(t,e)},MenuItem.prototype.doAnimateContent=function(e,n){var i=this.element,r=t(i).children().first().find(".menu-content");0==r.length&&(r=t(i).children().first());var a=this.data.content[e];null!=a.before&&d(r,this.getAnimationProperties(a.before,n));var u,o=null!=n&&null!=n.queue?n.queue:"fx";for(var s in t(r).stop(o,!0).animate(this.getAnimationProperties(a.properties,n),{duration:1==a.animate?a.duration:0,queue:o,complete:(u=this.getAnimationProperties(a.after,n),function(){null!=u&&d(this,u)}),step:function(t){return function(){null!=t&&d(this,t)}}(this.getAnimationProperties(a.step,n))}).dequeue(o),a)if(0==s.indexOf("child:")){for(var l=s.substr(6).split(":"),h=r,p=0;p<l.length;p++)h=t(h).children().eq(l[p]);null!=a[s].tag&&(h=t(h).find(a[s].tag)),t(h).stop(o,!0).animate(this.getAnimationProperties(a[s].properties,n),{duration:1==a.animate?null!=a[s].duration?a[s].duration:a.duration:0,queue:o,complete:function(t){return function(){null!=t&&d(this,t)}}(this.getAnimationProperties(a[s].after,n)),step:function(t){return function(){null!=t&&d(this,t)}}(this.getAnimationProperties(a[s].step,n))}).dequeue(o)}},MenuItem.prototype.hover=function(){0!=t(this).height()&&t(this)[0].itemData.animate("hover")},MenuItem.prototype.hoverIn=function(e,a){if("mouseenter"==e.type){if(1==r)return;0==i&&(i=!0)}if(0!=t(this).height()){if(1!=a){var u=t(this).find("div")[0].getBoundingClientRect(),o=e.clientX;if(o<parseInt(u.left)||o>=u.right)return;var s=e.clientY;if(s<parseInt(u.top)||s>=u.bottom)return}var l=t(this)[0].itemData;if(1==l.open)return;l.animate("hover_in"),l.expand(),l.open=!0,null==n||n==l||n.element.contains(e.target)||n.hoverOut.call(n.element),n=l}},MenuItem.prototype.hoverOut=function(e){if((1!=r||null==e||"mouseleave"!=e.type)&&0!=t(this).height()){var i=t(this)[0].itemData;!1!==i.autoHoverOut&&(o(i.element),i.animate("hover_out"),i.restore(),i.open=!1,i.autoHoverOut=void 0,n=void 0)}},MenuItem.prototype.expand=function(){var e=this.element,n=t(e).attr("data-anim");if(null!=n){var i=n.split(";"),r=h();if(r<i.length){var a=i[r];if(a.length>0){var u,o=a.split(":"),s=o[0];if("push_right"==s)(l=o[2])<0&&(s+=":move_up"),u={dx:o[1],dy:l};else if("push_left"==s){(l=o[2])<0&&(s+=":move_up"),u={dx:o[1],dy:l}}else if("push_up"==s){u={dx:o[1],dy:o[2]}}else if("push_down"==s){u={dx:o[1],dy:o[2]}}else if("expand_up"==s){u={dx:o[1],dy:o[2]}}else if("expand_down"==s){u={dx:o[1],dy:o[2]}}else if("expand_right"==s){(l=o[2])<0&&(s+=":move_up"),u={dx:o[1],dy:l}}else if("expand_left"==s){var l;(l=o[2])<0&&(s+=":move_up"),u={dx:o[1],dy:l}}t.extend(u,{queue:"alt_fx"}),this.animate(s,u)}}}},MenuItem.prototype.restore=function(){var e=this.element,n=t(e).attr("data-anim");if(null!=n){var i=n.split(";"),r=h();if(r<i.length){var a=i[r];if(a.length>0){var u,o=a.split(":"),s=o[0];if("push_right"==s)s="pull_left",(l=o[2])<0&&(s+=":move_down"),u={dx:o[1],dy:l};else if("push_left"==s){s="pull_right",(l=o[2])<0&&(s+=":move_down"),u={dx:o[1],dy:l}}else if("push_up"==s){s="pull_down",u={dx:o[1],dy:o[2]}}else if("push_down"==s){s="pull_up",u={dx:o[1],dy:o[2]}}else if("expand_up"==s){s="shrink_down",u={dx:o[1],dy:o[2]}}else if("expand_down"==s){s="shrink_up",u={dx:o[1],dy:o[2]}}else if("expand_right"==s){s="shrink_left",(l=o[2])<0&&(s+=":move_down"),u={dx:o[1],dy:l}}else if("expand_left"==s){var l;s="shrink_right",(l=o[2])<0&&(s+=":move_down"),u={dx:o[1],dy:l}}t.extend(u,{queue:"alt_fx"}),this.animate(s,u)}}}},MenuItem.prototype.show=function(){var e=t(this)[0].itemData;!0,p(this),e.animate("show",{complete:function(){!1,console.log("menuShow = false")}})},MenuItem.prototype.hide=function(){t(this)[0].itemData.animate("hide")},Menu.prototype=new MenuItem,Menu.prototype.animateContent=function(t){for(var e in this.items){this.items[e].animateContent(t)}},t(window).on("touchmove",function(t){null!=n&&n.hoverOut.call(n.element)})}();
